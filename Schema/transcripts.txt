create table public.transcripts (
  id uuid not null default gen_random_uuid (),
  interview_id uuid not null,
  candidate_id uuid not null,
  file_path text not null,
  created_at timestamp with time zone not null default now(),
  updated_at timestamp with time zone not null default now(),
  score text null,
  recommendation text null,
  report_link text null,
  video_recording_url text null,
  chunk_count integer null,
  duration text null,
  constraint transcripts_pkey primary key (id),
  constraint fk_transcripts_candidate_id foreign KEY (candidate_id) references candidate (id) on delete CASCADE,
  constraint fk_transcripts_interview_id foreign KEY (interview_id) references interview (id) on delete CASCADE
) TABLESPACE pg_default;

create trigger transcript_duration_insert_trigger
after INSERT on transcripts for EACH row
execute FUNCTION handle_transcript_duration_update ();

create trigger transcript_duration_update_trigger
after
update OF duration on transcripts for EACH row when (new.duration is distinct from old.duration)
execute FUNCTION handle_transcript_duration_update ();

create trigger trg_after_update_attempt_at
after INSERT
or
update on transcripts for EACH row
execute FUNCTION update_results_attempted_at ();

create trigger trigger_new_transcript
after INSERT on transcripts for EACH row
execute FUNCTION handle_new_transcript ();

create trigger trigger_transcript_update
after
update on transcripts for EACH row
execute FUNCTION handle_transcript_update ();

create trigger update_transcripts_updated_at BEFORE
update on transcripts for EACH row
execute FUNCTION update_updated_at_column ();